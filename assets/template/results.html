<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width initial-scale=1">

		<title>{{ search.keywords }} - Curly Turtle</title>

		<link rel="shortcut icon" href="{{ program.baseurl }}/favicon.ico">
		<link rel="icon" sizes="192x192" href="{{ program.baseurl }}/favicon-192.png">
		<link rel="apple-touch-icon" sizes="192x192" href="{{ program.baseurl }}/favicon-192.png">
		<link rel="stylesheet" href="{{ program.baseurl }}/style.css">
		
		<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
	</head>

	<body>
		<div id="top-bar">
			<a href="{{ program.baseurl }}/"><img class="small-logo" src="{{ program.baseurl }}/favicon-192.png" alt="Curly Turtle"></a>
			<form id="search"  action="{{ program.baseurl }}/search">
				<input type="text" name="q" value="{{ search.keywords }}" required autocomplete="off" autofocus>
				<input type="submit" value="Search">
				<a id="show-advanced-options" href="javascript: showAdvanced()">Show advanced options</a>
				<table id="advanced-options">
					<thead>
						<th colspan="2">Advanced options</th>
					</thead>
					<tbody>
						<tr>
							<td>Language: </td>
							<td>
								<select name="hl">
									<option value="en">English</option>
									<option value="fr">French</option>
									<option value="de">German</option>
									<option value="es">Spanish</option>
									<option value="js">Japanese</option>
									<option value="ko">Korean</option>
									<option value="ru">Russian</option>
									<option value="zh-TW">Chinese (Traditional)</option>
									<option value="zh-CN">Chinese (Simplified)</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>Safe search: </td>
							<td>
								<select name="safe">
									<option value="on">On</option>
									<option value="off">Off</option>
								</select>
							</td>
						</tr>
					</tbody>
				</table>
			</form>
		</div>

		<p class="status">{% if search.status == "success" %}Found about {{ search.resultstats }} results.{% else %}{{ search.status }}{% endif %}</p>

		{% if search.results %}
		<ul id="result-list">
			{% for result in search.results %}
			<li class="result">
				<h3 class="result-title"><a href="{{ result.link }}">{{ result.title }}</a></h3>
				<p class="result-link">{{ result.link }}</p>
				{% if result.images %}<div class="result-images">{% for image in result.images %}<a href="{{ image.link }}"><img src="{{ program.baseurl }}{{ image.src }}" alt="{{ image.alt }}"></a>{% endfor %}</div>{% endif %}
				{% if result.description %}<p class="result-description">{{ result.description | replace: "<br>", "" }}</p>{% endif %}
			</li>
			{% endfor %}
		</ul>
		{% endif %}

		<div class="powered-by">Powered by <a href="https://github.com/FiveYellowMice/curly-turtle">Curly Turtle</a> v{{ program.version }}. But all results are from <a href="https://www.google.com">Google</a>.</div>
		
		<script>
			$(document).ready(function () {
				$("#advanced-options").hide();
				$("#show-advanced-options").show();

				$("#advanced-options [name=hl] [value=" + getUrlVars().hl + "]").attr("selected", "selected");
				$("#advanced-options [name=safe] [value=" + getUrlVars().safe + "]").attr("selected", "selected");

				if (localStorage) {
					localStorage.setItem("hl", getUrlVars().hl);
					localStorage.setItem("safe", getUrlVars().safe);
				}

				var pageNumber = 0;
				if ( getUrlVars().start ) pageNumber = Math.floor( getUrlVars().start / 10 );
				if ( Number("{{ search.resultstats }}".match(/\d+/g).join("")) > 10 ) {
					$(".status").append(" Showing page " + (pageNumber + 1) + ".");
					$("#result-list").after("<div id=\"paginator\"></div>");

					if ( pageNumber > 0 ) {
						$("#paginator").append("<a href=\"" + location.pathname + location.search.replace(/(\?|&)start=[^& #]*/, "$1start=" + (pageNumber * 10 - 10)) + "\">&lt; Previous page</a>");
					}
					$("#paginator").append(" | Go to page: <input id=\"page-number-input\" size=\"2\" type=\"text\" autocomplete=\"off\">");

					var nextPageSearchString;
					if ( getUrlVars().start ) {
						nextPageSearchString = location.search.replace(/(\?|&)start=[^& #]*/, "$1start=" + (pageNumber * 10 + 10));
					} else {
						nextPageSearchString = location.search + "&start=10";
					}
					$("#paginator").append(" | <a href=\"" + location.pathname + nextPageSearchString + "\">Next page &gt;</a>");

					$("#page-number-input").on("keydown", pageNumberInputChanged);
				}
			});

			function showAdvanced(){
				$("#show-advanced-options").hide();
				$("#advanced-options").fadeIn(500);
			}

			function getUrlVars() {
				var vars = [], hash;
				var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				for(var i = 0; i < hashes.length; i++) {
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			}

			function pageNumberInputChanged(event) {
				$("#page-number-input").val($("#page-number-input").val().replace(/\D/, ""));

				if ( event.keyCode === 13 && $("#page-number-input").val().length > 0 ) {
					var targetPage = Number($("#page-number-input").val()) - 1;
					if ( getUrlVars().start ) {
						location = location.pathname + location.search.replace(/(\?|&)start=[^& #]*/, "$1start=" + (targetPage * 10));
					} else {
						location = location.pathname + location.search + "&start=" + (targetPage * 10);
					}
				}
			}
		</script>
	</body>
</html>
